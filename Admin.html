<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Адмін-панель СЗУ</title>

<style>
    body {
        margin: 0;
        background: #000;
        color: #fff;
        font-family: "Segoe UI", sans-serif;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
        text-shadow: 0 0 15px red;
    }
    .card {
        max-width: 900px;
        margin: 0 auto 20px;
        background: #0b0b0f;
        border-radius: 14px;
        border: 1px solid rgba(255,39,39,0.7);
        box-shadow: 0 0 20px rgba(255,0,0,0.6);
        padding: 18px;
    }
    label {
        display: block;
        margin-top: 8px;
        font-size: 13px;
        opacity: 0.9;
    }
    input, textarea, select {
        width: 100%;
        margin-top: 4px;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid rgba(255,39,39,0.6);
        background: #111;
        color: #fff;
        font-size: 14px;
    }
    textarea {
        min-height: 70px;
        resize: vertical;
    }
    button {
        margin-top: 12px;
        padding: 9px 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        background: #ff2727;
        color: #fff;
        font-weight: 600;
        box-shadow: 0 0 14px rgba(255,0,0,0.7);
    }
    button:hover {
        background: #d00000;
    }

    .hidden { display: none; }

    .items-list {
        margin-top: 12px;
    }
    .item-row {
        padding: 10px;
        border-radius: 10px;
        background: #111;
        border: 1px solid rgba(255,39,39,0.4);
        margin-bottom: 8px;
        font-size: 13px;
    }
    .item-row h4 {
        margin: 0 0 4px;
        font-size: 14px;
        color: #ff5757;
    }
    .item-actions {
        margin-top: 6px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    .btn-small {
        padding: 4px 10px;
        font-size: 12px;
        border-radius: 999px;
    }
    .btn-danger { background: #d00000; }
    .btn-edit { background: #007cff; }

    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    /* Пошук */
    #searchInput {
        width: 300px;
        padding: 8px 12px;
        margin-bottom: 12px;
    }

    /* Прев’ю фото */
    #imgPreview {
        margin-top: 10px;
        max-width: 200px;
        border-radius: 10px;
        border: 1px solid red;
        display: none;
    }

    /* Кнопки сортування */
    .sort-bar { display: flex; gap: 10px; margin-bottom: 14px; }
    .sort-btn { background: #222; border: 1px solid red; }
</style>
</head>
<body>

<h1>Адмін-панель СЗУ</h1>

<!-- ЛОГІН -->
<div id="loginBox" class="card">
    <h2>Вхід адміністратора</h2>
    <label>Email</label>
    <input id="loginEmail" type="email" placeholder="admin@example.com" />
    <label>Пароль</label>
    <input id="loginPass" type="password" placeholder="Пароль" />
    <button id="btnLogin">Увійти</button>
</div>

<!-- АДМІН-ПАНЕЛЬ -->
<div id="adminPanel" class="hidden">

    <div class="card">
        <div class="top-bar">
            <span id="userInfo"></span>
            <button id="btnLogout" class="btn-small">Вийти</button>
        </div>
    </div>

    <!-- Додати / Редагувати -->
    <div class="card">
        <h2 id="formTitle">Додати засіб ураження</h2>

        <input id="editId" class="hidden" />

        <label>Назва</label>
        <input id="w_name" />

        <label>Категорія</label>
        <select id="w_type">
            <option value="bp">Боєприпаси</option>
            <option value="rk">Ракетні комплекси</option>
            <option value="pvo">ППО</option>
            <option value="uav">Дрони</option>
        </select>

        <label>Тег</label>
        <input id="w_tag" />

        <label>Характеристики (кожна з нового рядка)</label>
        <textarea id="w_specs"></textarea>

        <label>Опис</label>
        <textarea id="w_desc"></textarea>

        <label>URL фото</label>
        <input id="w_img" />

        <img id="imgPreview" />

        <button id="btnSaveWeapon">Зберегти</button>
    </div>

    <!-- Сортування + пошук -->
    <div class="card">
        <h2>Усі засоби ураження</h2>

        <div class="sort-bar">
            <button class="sort-btn" data-sort="name">Сортувати: Назва</button>
            <button class="sort-btn" data-sort="type">Сортувати: Категорія</button>
        </div>

        <input id="searchInput" type="text" placeholder="Пошук..." />

        <div id="weaponsList" class="items-list"></div>
    </div>

</div>


<script type="module">

// ====================== FIREBASE ======================
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
    getFirestore,
    collection,
    addDoc,
    updateDoc,
    deleteDoc,
    doc,
    getDocs
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

import {
    getAuth,
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

// ====================== CONFIG ======================
const firebaseConfig = {
    apiKey: "AIzaSyDRSzMxpXUox4_pW4ruMXZsXw1Kppi_P8Y",
    authDomain: "rooot-71962.firebaseapp.com",
    projectId: "rooot-71962",
    storageBucket: "rooot-71962.firebasestorage.app",
    messagingSenderId: "718921321052",
    appId: "1:718921321052:web:614928382d93d2b50eb499"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);
const auth = getAuth();

// ====================== DOM ======================
const loginBox   = document.getElementById("loginBox");
const adminPanel = document.getElementById("adminPanel");
const userInfo   = document.getElementById("userInfo");

const btnLogin  = document.getElementById("btnLogin");
const loginEmail = document.getElementById("loginEmail");
const loginPass  = document.getElementById("loginPass");
const btnLogout = document.getElementById("btnLogout");

const formTitle = document.getElementById("formTitle");
const editId = document.getElementById("editId");

const w_name  = document.getElementById("w_name");
const w_type  = document.getElementById("w_type");
const w_tag   = document.getElementById("w_tag");
const w_desc  = document.getElementById("w_desc");
const w_specs = document.getElementById("w_specs");
const w_img   = document.getElementById("w_img");
const btnSaveWeapon = document.getElementById("btnSaveWeapon");

const imgPreview = document.getElementById("imgPreview");
const weaponsList = document.getElementById("weaponsList");
const searchInput = document.getElementById("searchInput");

let weapons = [];


// ====================== AUTH ======================
onAuthStateChanged(auth, (user) => {
    if (user) {
        loginBox.classList.add("hidden");
        adminPanel.classList.remove("hidden");
        userInfo.textContent = "Увійшов: " + user.email;
        loadWeapons();
    } else {
        loginBox.classList.remove("hidden");
        adminPanel.classList.add("hidden");
    }
});

btnLogin.onclick = async () => {
    try {
        await signInWithEmailAndPassword(auth, loginEmail.value, loginPass.value);
    } catch (e) {
        alert("Помилка входу: " + e.message);
    }
};

btnLogout.onclick = () => signOut(auth);


// ====================== LOAD ======================
async function loadWeapons() {
    const snap = await getDocs(collection(db, "weapons"));
    weapons = [];

    snap.forEach(d => weapons.push({ id: d.id, ...d.data() }));

    renderWeapons(weapons);
}


// ====================== RENDER ======================
function renderWeapons(list) {
    weaponsList.innerHTML = "";

    list.forEach(w => {
        const row = document.createElement("div");
        row.className = "item-row";
        row.innerHTML = `
            <h4>${w.name}</h4>
            <small>${w.type.toUpperCase()} • ${w.tag}</small>

            <div class="item-actions">
                <button class="btn-small btn-edit" data-id="${w.id}">Редагувати</button>
                <button class="btn-small btn-danger" data-id="${w.id}">Видалити</button>
            </div>
        `;

        // Редагування
        row.querySelector(".btn-edit").onclick = () => loadForEdit(w);

        // Видалення
        row.querySelector(".btn-danger").onclick = () => deleteWeapon(w.id);

        weaponsList.appendChild(row);
    });
}


// ====================== PREVIEW IMAGE ======================
w_img.oninput = () => {
    imgPreview.src = w_img.value;
    imgPreview.style.display = w_img.value.trim() ? "block" : "none";
};


// ====================== ADD / UPDATE ======================
btnSaveWeapon.onclick = async () => {
    const data = {
        name: w_name.value.trim(),
        type: w_type.value,
        tag:  w_tag.value.trim(),
        desc: w_desc.value.trim(),
        img:  w_img.value.trim(),
        specs: w_specs.value.split("\n").map(l => l.trim()).filter(l => l)
    };

    try {
        if (editId.value) {
            // UPDATE
            await updateDoc(doc(db, "weapons", editId.value), data);
            alert("Оновлено!");
        } else {
            // ADD
            await addDoc(collection(db, "weapons"), data);
            alert("Додано!");
        }

        clearForm();
        loadWeapons();

    } catch (e) {
        alert("Помилка: " + e.message);
    }
};


// ====================== LOAD FOR EDIT ======================
function loadForEdit(w) {
    editId.value = w.id;

    w_name.value  = w.name;
    w_type.value  = w.type;
    w_tag.value   = w.tag;
    w_desc.value  = w.desc;
    w_img.value   = w.img;
    w_specs.value = (w.specs || []).join("\n");

    imgPreview.src = w.img;
    imgPreview.style.display = "block";

    formTitle.textContent = "Редагувати засіб";
    btnSaveWeapon.textContent = "Оновити";
}


// ====================== CLEAR FORM ======================
function clearForm() {
    editId.value = "";
    w_name.value = "";
    w_tag.value = "";
    w_desc.value = "";
    w_specs.value = "";
    w_img.value = "";
    imgPreview.style.display = "none";

    formTitle.textContent = "Додати засіб ураження";
    btnSaveWeapon.textContent = "Зберегти";
}


// ====================== DELETE ======================
async function deleteWeapon(id) {
    if (!confirm("Видалити?")) return;
    await deleteDoc(doc(db, "weapons", id));
    loadWeapons();
}


// ====================== SORTING ======================
document.querySelectorAll(".sort-btn").forEach(btn => {
    btn.onclick = () => {
        const key = btn.dataset.sort;
        const sorted = [...weapons].sort((a, b) => a[key].localeCompare(b[key]));
        renderWeapons(sorted);
    };
});


// ====================== SEARCH ======================
searchInput.oninput = () => {
    const q = searchInput.value.toLowerCase();
    const filtered = weapons.filter(w =>
        w.name.toLowerCase().includes(q) ||
        w.tag.toLowerCase().includes(q)
    );
    renderWeapons(filtered);
};

</script>
</body>
</html>
